<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Olla Pitadora</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFD700">

    <style>
        /* --- BLOQUEO TOTAL NIVEL DIOS --- */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            outline: none !important;
            caret-color: transparent !important; /* Muerte al cursor */
        }

        html, body {
            height: 100%;
            overflow: hidden;
            cursor: default;
            background-color: #FFD700; 
        }

        body { 
            font-family: 'Arial Black', sans-serif; 
            margin: 0; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            flex-direction: column; 
        }

        /* ELEMENTOS CLICKEABLES */
        button, a, .region-option label {
            pointer-events: auto;
            cursor: pointer;
        }

        /* TEXTOS INTOCABLES */
        h1, h2, h3, p, div, span, .big-text {
            cursor: default;
            pointer-events: none; 
        }

        .screen { display: none; width: 90%; max-width: 400px; height: 100%; flex-direction: column; justify-content: center; align-items: center; box-sizing: border-box; position: relative; }
        .active { display: flex; }
        
        .card { 
            background: white; 
            padding: 20px; 
            border-radius: 20px; 
            box-shadow: 8px 8px 0 #111; 
            border: 4px solid #111; 
            width: 100%; 
            margin-bottom: 20px; 
            box-sizing: border-box;
            pointer-events: none;
        }
        
        button { background-color: #111; color: white; border: none; padding: 18px; font-size: 1.1rem; font-weight: bold; border-radius: 12px; width: 100%; text-transform: uppercase; box-shadow: 4px 4px 0 rgba(0,0,0,0.2); transition: transform 0.1s; touch-action: manipulation; margin-bottom: 10px;}
        button:active { transform: scale(0.96); }
        
        .btn-secondary { background: white; color: #111; border: 3px solid #111; }
        .btn-peque { background-color: #D32F2F; border: 3px solid #111; } 
        .btn-medio { background-color: #FF9800; border: 3px solid #111; } 
        .btn-grande { background-color: #4CAF50; border: 3px solid #111; } 

        .btn-omitir {
            background-color: #D32F2F; color: white; border: 3px solid #111; padding: 15px; margin-top: 10px; display: flex; flex-direction: column; align-items: center; line-height: 1.2;
        }
        
        .link-discreto { 
            background: transparent; border: none; color: #111; font-size: 0.85rem; text-decoration: underline; margin-top: 15px; padding: 10px; box-shadow: none; text-transform: none; opacity: 0.9; display: block;
        }
        
        /* Enlaces que parecen botones o texto */
        a { text-decoration: none; color: inherit; }

        .region-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; margin-bottom: 20px; }
        .region-option { position: relative; }
        .region-option input { display: none; }
        .region-option label { 
            display: block; background: #fff; border: 3px solid #111; padding: 10px; border-radius: 10px; font-size: 0.9rem; color: #555; transition: 0.2s; box-shadow: 2px 2px 0 rgba(0,0,0,0.1); 
        }
        .region-option input:checked + label { background: #111; color: #FFD700; border-color: #111; transform: scale(1.02); box-shadow: 4px 4px 0 rgba(0,0,0,0.2); }
        .region-option input:disabled + label { background: #e0e0e0; color: #555; border-color: #999; cursor: default; pointer-events: none; }

        .penitencia-check input:checked + label { background: #D32F2F; color: white; border-color: #111; }

        h1 { line-height: 1; margin-bottom: 5px; }
        h2 { font-size: 1.4rem; color: #111; margin-bottom: 15px; }
        .big-text { font-size: 6rem; margin: 10px 0; color: #111; line-height: 1; }
        #tema-display { font-size: 1.4rem; line-height: 1.2; word-wrap: break-word; }
        
        .btn-cancel { position: absolute; top: 0; right: 0; width: 50px; height: 50px; background: #D32F2F; color: white; border-radius: 50%; font-size: 1.5rem; line-height: 1; padding: 0; margin: 0; box-shadow: 2px 2px 0 rgba(0,0,0,0.3); z-index: 100; display: flex; justify-content: center; align-items: center; pointer-events: auto; }

        /* LOADING */
        #screen-loading { background-color: #000; color: #0f0; font-family: 'Courier New', monospace; text-align: left; padding: 20px; }
        .log-line { margin-bottom: 5px; font-size: 0.8rem; white-space: nowrap; border-right: 2px solid #0f0; }
        .loader-bar { width: 100%; height: 12px; background: #222; border: 1px solid #0f0; margin-top: 20px; }
        .loader-progress { width: 0%; height: 100%; background: #0f0; transition: width 0.4s; }

        /* SCROLL (Instrucciones) */
        .scroll-content { width: 100%; max-height: 60vh; overflow-y: auto; text-align: left; background: rgba(255,255,255,0.95); border: 3px solid #111; border-radius: 15px; padding: 15px; box-sizing: border-box; margin-bottom: 15px; font-family: 'Arial', sans-serif; font-size: 0.9rem; line-height: 1.4; color: #222; pointer-events: auto; }
        .scroll-content h3 { margin-top: 15px; color: #D32F2F; font-family: 'Arial Black', sans-serif; font-size: 1rem; text-transform: uppercase; }
        .scroll-content h3:first-child { margin-top: 0; }

        .logo-main { width: 150px; height: 150px; object-fit: contain; margin-bottom: 10px; filter: drop-shadow(5px 5px 0px rgba(0,0,0,0.2)); pointer-events: none; }

        /* MODAL */
        #modal-explosion { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; animation: shake 0.5s; }
        #modal-explosion.active { display: flex; }
        .modal-content { background: #FFD700; border: 5px solid #111; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 0 50px rgba(255, 0, 0, 0.5); pointer-events: auto; }

        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

    <!-- MODAL EXPLOSI√ìN -->
    <div id="modal-explosion">
        <div class="modal-content">
            <h1 style="color:#D32F2F; font-size:3rem; margin:0;">¬°PUM!</h1>
            <h2 style="margin-top:0;">SE ESTALL√ì LA OLLA</h2>
            <div id="modal-mensaje" style="font-size:1.5rem; font-weight:bold; margin:20px 0; line-height:1.2;">...</div>
            <div style="display:flex; gap:10px;">
                <button onclick="soyUnaLoca()" style="background:#111; color:#FFD700; width:50%; font-size:1rem; padding:15px; border:2px solid #FFD700;">¬°SOY UNA LOCA!</button>
                <button onclick="aceptarReto()" style="background:#4CAF50; color:#fff; width:50%; font-size:1rem; padding:15px;">¬°H√ÅGALE!</button>
            </div>
        </div>
    </div>

    <!-- LOADING (FALSO, SOLO EST√âTICO) -->
    <div id="screen-loading" class="screen">
        <div id="log-container"></div>
        <div class="loader-bar"><div id="loader-fill" class="loader-progress"></div></div>
        <p style="text-align:center; color:#0f0; margin-top:15px; font-size:0.75rem;">CALENTANDO LA OLLA...</p>
    </div>

    <!-- HOME -->
    <div id="screen-home" class="screen active">
        <img src="logo.png" class="logo-main" alt="La Olla Pitadora">
        <h1 style="font-size: 2.2rem; margin-top:0;">La Olla Pitadora</h1>
        <p style="margin-bottom: 20px;">¬°Ojo que esa vaina estalla!</p>
        <button onclick="showScreen('screen-setup')" style="background-color: #111; color: #FFD700; border: 3px solid #111; height: 70px; font-size: 1.4rem;">¬°ARMAR PARCHE!</button>
        <div style="display: flex; gap: 10px; width: 100%;">
            <button onclick="showScreen('screen-install')" class="btn-secondary" style="font-size: 0.8rem; padding: 10px;">üì≤ INSTALAR APP</button>
            <button onclick="showScreen('screen-instructions')" class="btn-secondary" style="font-size: 0.8rem; padding: 10px;">‚ùì C√ìMO JUGAR</button>
        </div>
        
        <!-- ENLACE EXTERNO A SUGERENCIAS -->
        <a href="sugerencias.html" class="link-discreto" style="opacity:0.7; font-size:0.8rem;">üí° Sugerencias y Mejoras</a>
        
        <button onclick="actualizarApp()" id="btn-update" class="link-discreto" style="opacity:0.5; font-size:0.7rem; margin-top:20px;">üîÑ Buscar Actualizaciones</button>
    </div>

    <!-- INSTRUCCIONES -->
    <div id="screen-instructions" class="screen">
        <h2 style="margin-bottom: 10px;">C√ìMO JUGAR</h2>
        <div class="scroll-content">
            <h3>¬øDe qu√© se trata?</h3>
            <p>Esto es como la papa caliente pero versi√≥n "La Olla Pitadora". El tiempo corre, la olla pita y al que le estalle... ¬°Paila!</p>
            <h3>üî• La Mec√°nica:</h3>
            <ul>
                <li><b>Configure:</b> Regiones y si quiere penitencias bravas.</li>
                <li><b>Escoja el fuego:</b> ¬øLento, medio o a toda mecha?</li>
                <li><b>Sale un tema:</b> "Cosas que uno empe√±a", "Excusas pa'l mozo", etc.</li>
                <li><b>Empieza el Piteo:</b> El sonido arranca suave... pero se va acelerando. ¬°H√°gale pues!</li>
                <li><b>Diga y Rote:</b> Diga una palabra con la letra que sale y pase ese celular volando.</li>
            </ul>
            <h3>¬°PUM! Estall√≥:</h3>
            <p>Al que le explote en la mano paga penitencia o fondo blanco. Sin llorar.</p>
        </div>
        <button onclick="showScreen('screen-home')" style="background-color: #111; color: #FFD700;">VOLVER</button>
    </div>

    <!-- INSTALAR -->
    <div id="screen-install" class="screen">
        <h2 style="margin-bottom: 10px;">INSTALAR APP</h2>
        <div class="scroll-content">
            <p>Pa' que el juego se vea una chimba y sin barras:</p>
            <h3>üçé IPHONE (iOS):</h3>
            <ol>
                <li>Abra en <b>Safari</b>.</li>
                <li>Toque <b>"Compartir"</b> (flecha arriba ‚¨ÜÔ∏è).</li>
                <li>Busque <b>"Agregar a Inicio"</b>.</li>
                <li>Dele <b>"Agregar"</b>.</li>
            </ol>
            <h3>ü§ñ ANDROID:</h3>
            <ol>
                <li>Abra en <b>Chrome</b>.</li>
                <li>Toque los <b>3 punticos</b> (‚ãÆ).</li>
                <li>Busque <b>"Instalar aplicaci√≥n"</b>.</li>
                <li>Confirme.</li>
            </ol>
        </div>
        <button onclick="showScreen('screen-home')" style="background-color: #111; color: #FFD700;">VOLVER</button>
    </div>

    <!-- SETUP -->
    <div id="screen-setup" class="screen">
        <h2>¬øQUI√âNES ESTAMOS?</h2>
        <p style="font-size: 0.8rem; margin-top: -10px; margin-bottom: 10px;">Selecciona regiones y opciones:</p>
        <div class="region-grid">
            <div class="region-option"><input type="checkbox" id="reg-general" value="general" checked><label for="reg-general">üá®üá¥ General</label></div>
            <div class="region-option"><input type="checkbox" id="reg-paisa" value="paisa"><label for="reg-paisa">üèîÔ∏è Paisas</label></div>
            <div class="region-option"><input type="checkbox" id="reg-rolo" value="rolo"><label for="reg-rolo">‚òî Rolos</label></div>
            <div class="region-option"><input type="checkbox" id="reg-costeno" value="costeno"><label for="reg-costeno">üåä Coste√±os</label></div>
            <div class="region-option"><input type="checkbox" id="reg-valluno" value="valluno"><label for="reg-valluno">üíÉ Vallunos</label></div>
            <div class="region-option"><input type="checkbox" id="reg-santander" value="santander"><label for="reg-santander">üêú Santander</label></div>
        </div>
        <div style="width: 100%; margin-bottom: 20px;">
            <div class="region-option penitencia-check">
                <input type="checkbox" id="opt-penitencias" value="penitencias" checked>
                <label for="opt-penitencias">üòà ¬°ACTIVAR PENITENCIAS!</label>
            </div>
        </div>
        <h2>¬øQU√â TAN R√ÅPIDO?</h2>
        <div style="display:flex; flex-direction:column; gap:10px; width:100%;">
            <button class="btn-peque" onclick="this.blur(); configurarYJugar('peque')">EN PURA HP! üî• (R√°pido)</button>
            <button class="btn-medio" onclick="this.blur(); configurarYJugar('medio')">MASO MENITOS ü§ô (Normal)</button>
            <button class="btn-grande" onclick="this.blur(); configurarYJugar('grande')">SUAVE üê¢ (Largo)</button>
        </div>
        <button onclick="showScreen('screen-home')" style="background:transparent; color:#555; font-size:0.8rem; border:none; box-shadow:none; margin-top:10px;">Volver atr√°s</button>
    </div>

    <!-- RULETA -->
    <div id="screen-roulette" class="screen">
        <h2>LA VUELTA ES:</h2>
        <div class="card"><div id="tema-display">...</div></div>
        <div id="controles-tema" style="display:none; width:100%; flex-direction:column; gap:10px;">
            <button onclick="iniciarJuego()" style="background:#D32F2F">¬°P√ìNGALA A PITAR!</button>
            <button onclick="girarRuleta()" class="btn-secondary">CAMBIAR TEMA</button>
            <button onclick="showScreen('screen-setup')" style="background:transparent; border:none; color:#555; font-size:0.8rem; box-shadow:none; margin-top:10px;">Cambiar configuraci√≥n</button>
        </div>
    </div>

    <!-- JUEGO -->
    <div id="screen-game" class="screen">
        <button class="btn-cancel" onclick="cancelarPartida()">‚úñ</button>
        <h3 id="tema-juego" style="color:#D32F2F; text-transform:uppercase;">TEMA</h3>
        <div class="card"><div id="letra-display" class="big-text">A</div></div>
        <button onclick="cambiarLetra()" style="height:120px; font-size:1.8rem;">SIGUIENTE</button>
        
        <!-- BOT√ìN OMITIR -->
        <button onclick="omitirLetra()" class="btn-omitir">
            OMITIR üò±
            <span style="display:block; font-size:0.6rem; font-weight:normal; margin-top:3px;">¬°PIERDES TIEMPO!</span>
        </button>

        <button onclick="cancelarPartida()" class="link-discreto" style="margin-top:15px; color:#D32F2F; font-weight:bold;">üõë Terminar Partida</button>
    </div>

    <!-- FINAL -->
    <div id="screen-end" class="screen">
        <h1 style="font-size:4rem; color:#D32F2F; margin:0;">¬°ESTALL√ì!</h1>
        <h2 style="margin-top:-10px;">PERDI√ì EL A√ëO</h2>
        <div class="card">
            <div id="resultado-final" style="font-size:1.4rem; font-weight:bold; line-height:1.2;">FONDO BLANCO O PENITENCIA</div>
        </div>
        <button onclick="otraRonda()" style="background-color: #111; color: #FFD700; border: 3px solid #FFD700;">¬°OTRA RONDA!</button>
        <button onclick="showScreen('screen-setup')" class="btn-secondary">CAMBIAR PARCHE</button>
        <!-- Enlace al archivo externo -->
        <a href="sugerencias.html" class="link-discreto">Reportar un error o sugerir tema</a>
    </div>

    <script>
        const SEMILLA = "PARRANDA_SEC_2025";
        const CANTIDAD_MEMES = 20; 

        // --- MOTOR DE AUDIO ---
        let audioCtx = null;
        let backupAudio = new Audio('memes/1.mp3'); 

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            backupAudio.load(); 
        }

        function playTickSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle'; 
            osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
            osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1); 
            gain.gain.setValueAtTime(1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.15);
        }

        function playPenaltySound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime); 
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.4); 
            gain.gain.setValueAtTime(0.8, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.4);
        }

        function playSyntheticExplosion() {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * 2; 
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
            const noise = audioCtx.createBufferSource();
            noise.buffer = buffer;
            const filter = audioCtx.createBiquadFilter();
            filter.type = 'lowpass';
            filter.frequency.value = 1000;
            filter.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 1);
            const gain = audioCtx.createGain();
            gain.gain.setValueAtTime(1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.5);
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start();
        }

        function compartirApp() {
            if (navigator.share) {
                navigator.share({ title: 'La Olla Pitadora', text: '¬°Ojo que esa vaina estalla! Juguemos un parche bien bueno.', url: window.location.href }).catch(console.error);
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert("Link copiado. ¬°P√°salo!");
            }
        }

        function actualizarApp() {
            const btn = document.getElementById('btn-update');
            btn.innerText = "‚è≥ Verificando...";
            setTimeout(() => { window.location.reload(true); }, 800);
        }

        function showScreen(id) {
            window.getSelection().removeAllRanges();
            document.body.style.display = 'none';
            document.body.offsetHeight; 
            document.body.style.display = 'flex';
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // --- BASE DE DATOS Y L√ìGICA ---
        // (La misma l√≥gica y datos de las versiones anteriores se mantienen aqu√≠.
        //  Por brevedad, aseg√∫rate de que DB_TEMAS, DB_PENITENCIAS,
        //  generarMazoLetras, y las funciones de juego est√©n presentes
        //  tal cual la V9.2/V10.0 pero sin referencias a formularios)
        
        // ... (PEGAR AQU√ç LOS ARRAYS DB_TEMAS Y DB_PENITENCIAS DE LA RESPUESTA ANTERIOR) ...
        const DB_PENITENCIAS = [
            "Haga el 8 con la cola en la mitad de la sala", "Imite a Epa Colombia: 'Epa la arepa'", "Haga 10 flexiones de pecho ya mismo",
            "Llame a su ex y cuelgue (o mande audio)", "Baile 'El Pirulino' (Pedro el Escamoso)", "Haga el 4 para ver si est√° borracho",
            "Cante el coro de 'Mis Ojos Lloran por Ti' r√°pido", "Imite a Do√±a Gloria en el Metrocable", "Haga como perro tomando agua",
            "D√©jele ver su √∫ltima foto de galer√≠a al de la derecha", "T√≥mese un shot sin manos", "Hable como √±ero por 2 rondas",
            "Imite el video de 'Me la mecati√© en cositas'", "Haga el paso de Anitta (o int√©ntelo)", "Cante 'Yasuri Yamile' completa",
            "Haga como si estuviera vendiendo aguacates", "P√≥ngase los zapatos al rev√©s", "Haga sentadillas hasta que le vuelva a tocar",
            "Cante 'La Quemona' con sentimiento", "Imite a un vendedor de bus", "Haga como gallina poniendo un huevo",
            "T√≥mese una foto haciendo mueca y s√∫bala a historias", "Decl√°resele a la persona del frente", "Haga m√≠mica de 'Se me rompi√≥ el cond√≥n'",
            "Haga el sonido de un cerdo comiendo", "Beba un trago cruzando el brazo con el de al lado", "Haga el paso del 'Serrucho'",
            "Imite a Diomedes D√≠az", "Cuente un chiste malo, si nadie se r√≠e, bebe doble", "Haga pararse de manos (con ayuda)",
            "Grite por la ventana '¬°VECINA, SE LE QUEMA EL ARROZ!'", "Beba todo lo que tenga en el vaso", "Imite al 'Fuicioso'",
            "Haga como si estuviera en una monta√±a rusa", "Camine como modelo pasarela", "Imite a Shakira cantando",
            "Haga de cuenta que est√° en un comercial de TV", "Hable con acento mexicano toda la ronda", "Beba un trago de la bebida que menos le guste",
            "Haga masajes al de la derecha por 1 min", "Haga como un beb√© llorando", "Imite el sonido de una moto prendiendo",
            "Haga el baile del 'Aserej√©'", "Cante el Himno Nacional con la mano en el pecho", "Haga como si le estuviera dando un ataque",
            "Imite a un pol√≠tico corrupto", "Haga de cuenta que es un influencer vendiendo fajas", "Haga el sonido de un orgasmo fingido",
            "Imite a Betty la Fea ri√©ndose", "Haga como un gato en celo", "Chupezarle el dedo gordo del pie al de la izquierda",
            "Lamer el piso (o amagar)", "Hacer fondo blanco de rodillas", "Imitar a un borracho cans√≥n", "Cantar una de Dar√≠o G√≥mez",
            "Hacer twerking en la pared", "Imitar a la Liendra", "Decir el abecedario al rev√©s (si falla, bebe)", 
            "Hacer la pose de 'La Trevi' en el piso", "Gritar '¬°Qu√© viva el Paro!'", "Imitar a un √±ero pidiendo plata",
            "Hacer como si estuviera en una pel√≠cula de terror", "Bailar una champeta solo", "Hacer el paso del robot",
            "Cantar 'Rata de dos patas' se√±alando a alguien", "Hacer como un mico", "Imitar a un comentarista de f√∫tbol gritando gol",
            "Hacer caras feas para una selfie grupal", "Dejarse pintar la cara con un marcador", "Quitarse una prenda (que no sea ropa interior)",
            "Hacer 5 sapitos", "Darle un beso en la mejilla al de la izquierda", "Hacer como si estuviera en un bus lleno"
        ];
        
        const DB_TEMAS = {
            general: ["Personajes de Betty la Fea", "Personajes de Pedro el Escamoso", "Famosos Colombianos muertos", "Presentadoras de TV", "Influencers Colombianos", "Canciones de Diomedes", "Cantantes de Reggaeton", "Jugadores de la Selecci√≥n", "Comida de la calle", "Dulces de tienda", "Marcas de Cerveza", "Sabores de helado", "Frutas colombianas", "Ag√ºeros de Diciembre", "Groser√≠as Colombianas", "Excusas para llegar tarde", "Mentiras de Hombres", "Mentiras de Mujeres", "Cosas que uno compra fiao", "Remedios de la abuela", "Frases de Mam√°", "Cosas que dan Guayabo Moral", "Programas de TV viejos", "Marcas de ropa interior barata", "Cosas que uno guarda bajo el colch√≥n", "Mitos urbanos", "Posiciones sexuales", "Lugares para echar un polvo", "Apodos para el pene/vagina", "Motivos de divorcio", "Cosas que se dicen en el sexo", "Tipos de condones", "Juguetes sexuales", "Cosas que matan la pasi√≥n", "Fantas√≠as sexuales comunes", "Excusas para no culiar", "Cosas que uno hace borracho", "Tipos de Vecinos molestos", "Nombres de Se√±ora del aseo", "Nombres de Celadores", "Cosas que uno se roba de un hotel", "Marcas de celulares viejos", "Oficios varios", "Instrumentos musicales", "Cosas que uno pierde en una rumba", "Villanos de Telenovelas", "Juegos de infancia", "Marcas de carros en Colombia", "Tipos de borrachos", "Canciones para planchar", "Apodos para suegras", "Cosas que uno dice en una entrevista", "Excusas para terminar una relaci√≥n", "Nombres de bancos", "Marcas de arroz", "Partes del cuerpo que duelen con la edad", "Cosas que uno busca en Google", "Realities Colombianos", "Marcas de papel higi√©nico", "Cosas que uno pide en una droguer√≠a", "Nombres de centros comerciales", "Tipos de aretes", "Utensilios de cocina", "Cosas que hay en una billetera", "Marcas de Jab√≥n", "Frases de Conductor de Bus", "Nombres de Perros Criollos", "Marcas de Motos", "Cosas que huelen feo", "Platos de Navidad", "Villancicos famosos", "Regalos malos de amigo secreto", "Emisoras de radio", "Marcas de ropa cara", "Marcas de zapatos escolares", "Tipos de taxistas", "Vendedores ambulantes", "Cosas que se venden en un sem√°foro", "Frases de cajero autom√°tico", "Cosas que uno empe√±a", "Piropos de alba√±il"],
            paisa: ["Nombres de Neas", "Barrios calientes de Medell√≠n", "Estaciones del Metro", "Pueblos de Antioquia", "Nombres de Grilla", "Nombres de Chuzos de la 70", "Platos t√≠picos paisas", "Ingredientes de Bandeja Paisa", "Marcas de Guaro", "Cosas de una Finca", "Nombres de Moteles en Medallo", "Centros Comerciales de Medell√≠n", "Dichos Paisas", "Cosas que se venden en los buses", "Apodos de Narcos", "Sitios pa' puebliar", "Emisoras de Medell√≠n", "Barrios de Bello", "Barrios de Itag√º√≠", "Comidas r√°pidas de barrio", "Parques de Medell√≠n", "Apodos para los parceros", "Palabras Neas", "Nombres de fincas", "Estaciones del Metropl√∫s", "Rutas de buses de Medallo", "Centros Comerciales del Hueco", "Barrios de Envigado", "Sitios de rumba en el Lleras", "Marcas de ropa del Hueco", "Nombres de colegios p√∫blicos", "Platos con arepa", "Tipos de arepa paisa", "Miradores de Medell√≠n", "Cosas que pasan en el Metro", "Personajes del centro de Medell√≠n", "Pueblos del Suroeste", "Pueblos del Oriente", "Sitios para comer sancocho", "Veredas de Santa Elena", "Barrios de Robledo", "Barrios de Bel√©n", "Cosas de la Feria de las Flores", "Silleteros famosos", "Trovas famosas", "Palabras de abuelos paisas", "Sitios para ir a 'moteliar'", "Comida de carretera", "Dulces de pueblo", "Marcas de aguardiente tapa azul/roja", "Sitios de rumba en La 33", "Cosas que uno hace en Guatap√©", "Nombres de 'plazas' de vicio famosas (Barrios)", "Puentes de Medell√≠n", "Cerros tutelares", "Bibliotecas p√∫blicas", "Universidades de Medell√≠n"],
            rolo: ["Estaciones de Transmilenio", "Barrios de Gomelos", "Planes de Domingo en Bogot√°", "Cosas que pasan en el Transmi", "Ingredientes del Ajiaco", "Centros Comerciales de Bogot√°", "Pueblos de Cundinamarca", "Palabras de Rolo", "Excusas por el tranc√≥n", "Sitios para ir a Monserrate", "Nombres de Universidades de Bogot√°", "Chaquetas o Ropa de fr√≠o", "Zonas de rumba en Bogot√°", "Comida de piqueteadero", "Alcaldes de Bogot√°", "Parques de Bogot√°", "Barrios peligrosos de Bogot√°", "Universidades p√∫blicas vs privadas", "Emisoras de Bogot√°", "Portales de Transmilenio", "Sitios para comer en la Calera", "Planes de 'Sop√≥'", "Cosas que se compran en el 7 de Agosto", "Partes de un Ajiaco", "Tipos de Tamal", "Barrios del Sur", "Barrios del Norte", "Sitios de rumba en la 85", "Sitios de rumba en la Primera de Mayo", "Teatros de Bogot√°", "Museos de Bogot√°", "Cosas que pasan en la S√©ptima", "Personajes del centro de Bogot√°", "Vendedores de Transmilenio", "Rutas del SITP", "Centros Comerciales del Norte", "Centros Comerciales del Sur", "Pueblos de la Sabana", "Postres rolos (Cuajada, etc)", "Tipos de Chaqueta", "Lugares para pedir matrimonio en Bogot√°", "Bibliotecas de Bogot√°", "Platos de la Plaza de Paloquemao", "Sitios para comprar ropa usada", "Discotecas de Chapinero", "Bares de rock en Bogot√°", "Parques de diversiones", "Dulces santafere√±os", "Iglesias del centro", "Mitos de Bogot√°"],
            costeno: ["Dichos Coste√±os", "Comida Frita Coste√±a", "Comparsas del Carnaval", "Playas de la Costa", "Jugadores del Junior", "Canciones de Champeta", "Pueblos de la Costa", "Apodos coste√±os", "Cosas que dan calor", "Vallenatos corta venas", "Animales de la costa", "Ingredientes de un sancocho e' pescao", "Lugares de Barranquilla", "Lugares de Cartagena", "Barrios de Barranquilla", "Barrios de Cartagena", "Barrios de Santa Marta", "Platos con Guineo", "Tipos de Bollo", "Tipos de Suero", "Palabras coste√±as (Eche, Nojoda)", "Nombres de Pic√≥s famosos", "Playas del Tayrona", "Sitios tur√≠sticos de la Costa", "Comida de calle coste√±a", "Frutas coste√±as (Corozo, N√≠spero)", "Cantantes de Vallenato", "Acordeoneros famosos", "Festivales de la Costa", "Personajes del Carnaval", "Disfraces del Carnaval", "Tipos de pescado", "Comida de Semana Santa", "Dulces de Semana Santa", "Sitios para rumbear en Cartagena", "Sitios para rumbear en Barranquilla", "Centros Comerciales de la Costa", "R√≠os de la Costa", "Leyendas coste√±as (El hombre caim√°n)", "Cosas que uno hace en la playa", "Vendedores de playa", "Transporte en la costa (Mototaxi)", "Nombres de burras famosas", "Apodos de borrachos", "Cosas que pasan cuando se va la luz", "Juegos de domin√≥", "Marcas de Ron coste√±o"],
            valluno: ["Dulces Vallunos", "Grupos de Salsa", "Palabras Cale√±as", "Barrios de Cali", "Ingredientes del Cholado", "Pasos de Salsa", "Sitios de la Feria de Cali", "Platos t√≠picos del Valle", "Nombres de Pandebono", "R√≠os del Valle", "Sitios para bailar salsa", "Ingredientes del Champ√∫s", "Ingredientes del Aborrajado", "Tipos de Lulada", "Pueblos del Valle", "Balnearios del Valle", "Sitios para ir a comer en Cali", "Barrios peligrosos de Cali", "Barrios de ricos de Cali", "Estaciones del MIO", "Cosas que pasan en el MIO", "Centros Comerciales de Cali", "Cerros de Cali", "Personajes de Cali", "Orquestas de Salsa", "Cantantes de Salsa", "Canciones del Grupo Niche", "Canciones de Guayac√°n", "Platos de la Galer√≠a Alameda", "Frutas del Valle (Chontaduro)", "Cosas que se le echan al Chontaduro", "Sitios tur√≠sticos de Buga", "Sitios de Palmira", "Ingredientes del Sancocho Valluno", "Tipos de Manjarblanco", "Marcas de Aguardiente (Blanco)", "Sitios para 'azotar baldosa'", "Dichos vallunos (Ve, O√≠s)", "Cosas que uno compra en el sem√°foro en Cali", "Universidades de Cali", "Parques de Cali", "Mitos de Cali (Buziraco)", "Equipos de f√∫tbol del Valle", "Jugadores del Am√©rica/Cali"],
            santander: ["Palabras Santandereanas", "Platos t√≠picos", "Pueblos de Santander", "Cosas que hacen arrechar", "Sitios tur√≠sticos de Santander", "Groser√≠as Santandereanas", "Marcas de Gaseosa", "Comidas r√°pidas de Bucaramanga", "Ingredientes del Mute", "Tipos de Hormigas Culonas", "Sitios de Panachi", "Pueblos bonitos de Santander", "Barrios de Bucaramanga", "Centros Comerciales de Bucaramanga", "Parques de Bucaramanga", "Comida con pepitoria", "Tipos de Arepa Santandereana", "Cosas que se comen con pi√±a", "Dichos de las abuelas santandereanas", "Motivos para pelear", "Cosas que se venden en San Andresito", "Sitios para ir a Gir√≥n", "Sitios de Barichara", "Deportes extremos en San Gil", "R√≠os de Santander", "Personajes de Santander", "Cantantes santandereanos", "Futbolistas del Bucaramanga", "Comida de calle en Bucaramanga", "Marcas de zapatos (Bucaramanga)", "Dulces de Santander (Bocadillo)", "Tipos de Bocadillo Vele√±o", "Cosas que uno hace en un asado", "Sitios para tomar pola", "Nombres de tiendas en Santander", "Frases de pap√°s santandereanos"]
        };
        
        function generarMazoLetras() {
            let mazo = [];
            const comunes = ['A','E','O','S','R','N','I','L','C','M','P','T','D'];
            const medias = ['B','G','V','F','H','J','U'];
            const dificiles = ['Q','Z','√ë','Y'];
            const imposibles = ['K','W','X'];
            comunes.forEach(l => mazo.push(l,l,l,l));
            medias.forEach(l => mazo.push(l,l));
            dificiles.forEach(l => mazo.push(l));
            imposibles.forEach(l => mazo.push(l));
            return mazo;
        }

        let bolsaTemas = [];
        let bolsaLetras = [];
        let juegoActivo = false;
        let tiempoInicio = 0;
        let duracionTotal = 0;
        let timerID = null;

        const CONFIG_TIEMPO = {
            peque: { min: 30, max: 45 },
            medio: { min: 50, max: 70 },
            grande: { min: 90, max: 130 }
        };
        let rangoSeleccionado = CONFIG_TIEMPO.medio;

        function armarBolsaTemas() {
            let nuevaBolsa = [];
            if(document.getElementById('reg-general').checked) nuevaBolsa.push(...DB_TEMAS.general);
            if(document.getElementById('reg-paisa').checked) nuevaBolsa.push(...DB_TEMAS.paisa);
            if(document.getElementById('reg-rolo').checked) nuevaBolsa.push(...DB_TEMAS.rolo);
            if(document.getElementById('reg-costeno').checked) nuevaBolsa.push(...DB_TEMAS.costeno);
            if(document.getElementById('reg-valluno').checked) nuevaBolsa.push(...DB_TEMAS.valluno);
            if(document.getElementById('reg-santander').checked) nuevaBolsa.push(...DB_TEMAS.santander);

            if(nuevaBolsa.length === 0) {
                alert("¬°Oiga! Seleccione al menos una regi√≥n pues.");
                document.getElementById('reg-general').checked = true;
                nuevaBolsa.push(...DB_TEMAS.general);
            }
            nuevaBolsa.sort(() => Math.random() - 0.5);
            return nuevaBolsa;
        }

        function llenarBolsaLetras() { 
            bolsaLetras = generarMazoLetras();
            bolsaLetras.sort(() => Math.random() - 0.5); 
        }

        function sacarDeBolsa(bolsa, funcionLlenado) {
            if (bolsa.length === 0) {
                if(funcionLlenado === "temas") { bolsaTemas = armarBolsaTemas(); return bolsaTemas.pop(); }
                else if(funcionLlenado === "penitencias") { llenarBolsaPenitencias(); return bolsaPenitencias.pop(); }
                else { funcionLlenado(); } 
            }
            const indiceRandom = Math.floor(Math.random() * bolsa.length);
            const item = bolsa[indiceRandom];
            bolsa.splice(indiceRandom, 1);
            return item;
        }

        window.onload = () => {
            llenarBolsaLetras();
            llenarBolsaPenitencias();
            showScreen('screen-home');
        };

        function configurarYJugar(tipo) {
            initAudio();
            if(tipo === 'peque') rangoSeleccionado = CONFIG_TIEMPO.peque;
            else if(tipo === 'medio') rangoSeleccionado = CONFIG_TIEMPO.medio;
            else if(tipo === 'grande') rangoSeleccionado = CONFIG_TIEMPO.grande;

            bolsaTemas = armarBolsaTemas();
            girarRuleta();
            showScreen('screen-roulette');
        }

        function otraRonda() {
            girarRuleta();
            showScreen('screen-roulette');
        }

        function cancelarPartida() {
            juegoActivo = false;
            clearTimeout(timerID);
            showScreen('screen-setup');
        }

        function girarRuleta() {
            document.getElementById('controles-tema').style.display = 'none';
            const display = document.getElementById('tema-display');
            let i = 0;
            const animacion = setInterval(() => {
                display.innerText = bolsaTemas[Math.floor(Math.random()*bolsaTemas.length)];
                i++;
                if (i > 15) {
                    clearInterval(animacion);
                    const temaFinal = sacarDeBolsa(bolsaTemas, "temas");
                    display.innerText = temaFinal;
                    document.getElementById('controles-tema').style.display = 'flex';
                }
            }, 80);
        }

        function iniciarJuego() {
            initAudio();
            showScreen('screen-game');
            document.getElementById('tema-juego').innerText = document.getElementById('tema-display').innerText;
            juegoActivo = true;
            cambiarLetra();
            
            const segundosRandom = Math.floor(Math.random() * (rangoSeleccionado.max - rangoSeleccionado.min + 1)) + rangoSeleccionado.min;
            duracionTotal = segundosRandom * 1000;
            tiempoInicio = Date.now();
            
            motorDeJuego(); 
        }

        function motorDeJuego() {
            if (!juegoActivo) return;

            const ahora = Date.now();
            const tiempoTranscurrido = ahora - tiempoInicio;
            const tiempoRestante = duracionTotal - tiempoTranscurrido;

            if (tiempoRestante <= 0) {
                finJuego();
                return;
            }

            playTickSound();

            const porcentajeCompletado = tiempoTranscurrido / duracionTotal; 
            const delayMax = 1200; 
            const delayMin = 100;
            let proximoDelay = delayMax - (Math.pow(porcentajeCompletado, 2.5) * (delayMax - delayMin));
            
            if (proximoDelay < 100) proximoDelay = 100;

            if (tiempoRestante < proximoDelay) {
                timerID = setTimeout(motorDeJuego, tiempoRestante);
            } else {
                timerID = setTimeout(motorDeJuego, proximoDelay);
            }
        }

        function cambiarLetra() {
            const letraFinal = sacarDeBolsa(bolsaLetras, llenarBolsaLetras);
            document.getElementById('letra-display').innerText = letraFinal;
        }

        function omitirLetra() {
            if (!juegoActivo) return;
            playPenaltySound();
            const penalizacion = duracionTotal * 0.15;
            tiempoInicio -= penalizacion; 
            cambiarLetra();
        }

        function finJuego() {
            juegoActivo = false;
            clearTimeout(timerID);
            
            // Sonido Explosi√≥n
            playSyntheticExplosion();

            // Meme + Backup
            let randomMeme = Math.floor(Math.random() * CANTIDAD_MEMES) + 1;
            let memeAudio = new Audio(`memes/${randomMeme}.mp3`);
            let backupAudio = new Audio('memes/1.mp3');
            
            memeAudio.onerror = function() {
                backupAudio.currentTime = 0;
                backupAudio.play().catch(e => console.log("Backup audio error:", e));
            };
            
            setTimeout(() => {
                memeAudio.play().catch(e => {
                    backupAudio.currentTime = 0;
                    backupAudio.play();
                });
            }, 800);
            
            // Visual
            const hayPenitencias = document.getElementById('opt-penitencias').checked;
            const resultadoDisplay = document.getElementById('resultado-final');
            const mensajeModal = document.getElementById('modal-mensaje');
            const modal = document.getElementById('modal-explosion');
            
            let textoResultado = "";
            
            if (hayPenitencias) {
                const penitencia = sacarDeBolsa(bolsaPenitencias, "penitencias");
                textoResultado = "üòà " + penitencia.toUpperCase();
                resultadoDisplay.style.color = "#D32F2F";
            } else {
                textoResultado = "FONDO BLANCO O PENITENCIA";
                resultadoDisplay.style.color = "#111";
            }

            resultadoDisplay.innerText = textoResultado;
            mensajeModal.innerText = textoResultado;

            showScreen('screen-end');
            
            modal.classList.add('active');

            if(navigator.vibrate) navigator.vibrate([1000, 200, 1000]);
        }

        function cerrarModal() {
            document.getElementById('modal-explosion').classList.remove('active');
            showScreen('screen-end');
        }

        function aceptarReto() {
            cerrarModal();
        }

        function soyUnaLoca() {
            let audioLoca = new Audio('memes/15a.mp3');
            audioLoca.play().catch(e => console.log(e));
            cerrarModal();
        }
    </script>
</body>
</html>
